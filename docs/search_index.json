[["conditions-and-loops.html", "Chapter 5 Conditions and Loops 5.1 Conditions 5.2 if Statements 5.3 for 5.4 while loop 5.5 Toy Example", " Chapter 5 Conditions and Loops When you start to write more sophisticated programs with R, you will very often need to control the flow and order the execution in your code. You will usually run into two types of scenarios: Make the execution of a particular code chunk dependent on a condition (i.e., an expression that evaluates to TRUE or FALSE) Repeat a particular code chunk a certain number of times, which is often referred to as loops. In this Chapter, we will explore these core programming techniques using: if-else statements for and while loops However, in Chapter 11, we will talk about loops more and point you to the idiomatic ways of dealing with loops in R. 5.1 Conditions Before we talk about the flow controls, let’s deal with the more fundamental element of the control structures: what is a condition? To that end, let’s first explore a few important concepts: Boolean Values Comparison Operators Boolean Operators 5.1.1 Boolean Values Unlike numbers or characters, the Boolean data type has only two values, TRUE and FALSE. In R, the Boolean values TRUE and FALSE lack the quotes you place around strings, and they are always uppercase. cond1 &lt;- TRUE class(cond1) [1] &quot;logical&quot; 5.1.2 Comparison Operators Comparison Operators are important in programming. They compare two values and evaluate down to a single Boolean value. They are also referred to as relational operators. Comparison Operators in R Operator Meaning == Equal to != Not equal to &gt; Greater than &lt; Less than &gt;= Greater than or equal to &lt;= Less than or equal to X %in% Y X Is an member of Y These comparison operators return TRUE or FALSE depending on the values we give them. 45 == 45 [1] TRUE 45 &gt; 50 [1] FALSE 45 != 4 [1] TRUE Please note that these operators work not only with numbers but also characters as well. a &lt;- &quot;run&quot; b &lt;- &quot;run&quot; c &lt;- &quot;walk&quot; all &lt;- c(&quot;run&quot;,&quot;walk&quot;,&quot;march&quot;) a == b [1] TRUE a == c [1] FALSE c %in% all [1] TRUE When using comparison operators, be careful of the data types (i.e., numeric or character). a &lt;- &quot;42&quot; b &lt;- 42 a == 42.0 [1] TRUE a &gt; 40 [1] TRUE a == b [1] TRUE Please note the difference between == and =. The == operator asks whether two objects are the same as each other while the = operator assigns the value/object on the right into the variable name on the left. In R, the preferred way of assigment is to use &lt;- operator instead. 5.1.3 Boolean Operators There are three Boolean operators in R to compare two conditions: &amp; (and), | (or), and ! (not). That is, we can combine two or more conditions with these operators for more complex conditions. x &lt;- 47 x &gt; 30 | x &lt; 50 [1] TRUE x &lt;- 55 x &gt; 30 &amp; x &lt; 50 [1] FALSE x &lt;- 55 x &gt; 50 [1] TRUE !x &gt; 50 [1] FALSE 2 + 2 == 4 &amp; 2 + 2 == 5 &amp; 2 * 2 == 2 + 2 [1] FALSE 2 + 2 == 4 &amp; !2 + 2 == 5 &amp; 2 * 2 == 2 + 2 [1] TRUE The Boolean operators follow the order of operations in math. That is, R evaluates the ! (not) operator first, then the &amp; (and) operator, and then the | (or) operators. 5.1.4 Elements of Flow Control Flow control statements often start with a condition and are followed by a block of code. A quick recap: Conditions: Any Boolean expressions can be a potential condition, which evaluates down to a Boolean value (i.e., TRUE or FALSE). A flow control statement decides what to do and what to skip based on whether the condition is TRUE or FALSE. Block of Code: Lines of R code can be grouped together in blocks, using initial and ending curly brackets { and }. The beginning and ending of the block of code are clearly indicated. 5.2 if Statements The main purpose of if is to control precisely which operations are carried out in a given code chunk. An if statement runs a code chunk only if a certain condition is true. This conditional expression allows R to respond differently depending on whether the condition is TRUE or FALSE. The basic template of if is as follows: if(CONDITION IS TRUE){ DO THIS CODE CHUNK 1 } else { DO THIS CODE CHUNK 2 } The condition is placed in the parenthesis after if within (). The condition must be an expression that returns only a single logical value (TRUE or FALSE). If it is TRUE, the code chunk 1 in the curly braces will be executed; if the condition is not satisfied, the code chunk 2 in the curly braces after else will be executed. Let’s create a simple example simulating the password checking. Imagine that your system password is stored on the server. You can only get into the system if you enter the correct password. For every password you enter, the system gatekeeper will check if your input password matches the one stored on the server. If it does not match, you will be banned from entry. input &lt;- 113 # assuming that you have the input 113 ## Assuming that the system pass code is `987` if(input == 987){ writeLines(&quot;Congratulations! Now you may get in!&quot;) } else{ writeLines(&quot;Sorry! Wrong password.&quot;) } Sorry! Wrong password. If the input matches with the system pass code, you will be allowed to get through. input &lt;- 987 # assuming that you have the input 113 if(input == 987){ writeLines(&quot;Congratulations! Now you may get in!&quot;) } else{ writeLines(&quot;Sorry! Wrong password.&quot;) } Congratulations! Now you may get in! Now we can ask R to read the input directly from the user’s input in the R console: input &lt;- readline(prompt=&quot;Please enter your password:&quot;) if(input == 987){ writeLines(&quot;Congratulations! Now you may get in!&quot;) } else{ writeLines(&quot;Sorry! Wrong password.&quot;) } In R, there are two very similar functions, readline() and readLines(). Please check the documentations of these two to make sure you understand their differences. 5.3 for The for loop statement is to repeat a code chunk, often while incrementing an index or a counter. The most frequent scenario is to repeat a code chunk through a vector/list, element by element, or through a data frame row by row (or column by column). The basic for loop template is as follows: for(LOOP_INDEX in LOOP_VECTOR){ DO THIS CODE CHUNK } The LOOP_INDEX is a placeholder that represents an element in the LOOP_VECTOR. When the loop begins, the LOOP_INDEX starts off as the first element in the LOOP_VECTOR. When the loop reaches the end of the brace, the LOOP_INDEX is incremented, taking on the next element in the LOOP_VECTOR. This process continues until the loop reaches the final element of the LOOP_VECTOR. At this point, the code chunk is executed for the last time, and the loop exits. For example, if we have a character vector with a few words in it. We can use a for loop to get the number of characters for each element in the vector. word_vec &lt;- c(&quot;apple&quot;,&quot;banana&quot;,&quot;watermelon&quot;,&quot;papaya&quot;) for(w in word_vec){ word_nchar &lt;- nchar(w) writeLines(as.character(word_nchar)) } 5 6 10 6 For the above example, there is another way to write the for loop: for(i in 1:length(word_vec)){ word_nchar &lt;- nchar(word_vec[i]) writeLines(as.character(word_nchar)) } 5 6 10 6 In our first example, the LOOP_INDEX serves as the exact object in the LOOP_VECTOR. In our second example, the LOOP_INDEX serves as the index of the object in the LOOP_VECTOR. Exercise 5.1 Use the data set from stringr::sentences for this exercise. Create a for-loop structure to get the number of characters for all sentences in the stringr::sentences. Present your results in a data frame of three columns: Column 1 includes an unique integer ID for each sentence; Column 2 includes the texts of each sentence; Column 3 includes the number of characters of each sentence. Note: A for-loop structure is needed for this exercise. But it may not necessarily be the most efficient way. The data set stringr::sentences includes 720 English sentences. The first six sentences are shown here. [1] &quot;The birch canoe slid on the smooth planks.&quot; [2] &quot;Glue the sheet to the dark blue background.&quot; [3] &quot;It&#39;s easy to tell the depth of a well.&quot; [4] &quot;These days a chicken leg is a rare dish.&quot; [5] &quot;Rice is often served in round bowls.&quot; [6] &quot;The juice of lemons makes fine punch.&quot; Your results may look like the following data frame: Exercise 5.2 Use the data set stringr::fruit for this exercise. Create a for-loop and if-statement to instruct R to go through each fruit name and print out those fruit names that start with the vowel letters only (i.e., a, e, i, o, u). [1] &quot;apple&quot; [1] &quot;apricot&quot; [1] &quot;avocado&quot; [1] &quot;eggplant&quot; [1] &quot;elderberry&quot; [1] &quot;olive&quot; [1] &quot;orange&quot; [1] &quot;ugli fruit&quot; 5.4 while loop There is another type of loop. Unlike the for loop, which repeats a code chunk by going through every element in a vector/list/data frame, the while loop repeats a code chunk UNTIL a specific condition evaluates to FALSE (It’s like the opposite of if-statement) The basic template is as follows: while(LOOP_CONDITION){ DO THIS CODE CHUNK (UNTIL THE LOOP_CONDITION BECOMES FALSE) } Upon the start of a while loop, the LOOP_CONDITION is evaluated. If the condition is TRUE, the braced code chunk is executed line by line till the end of the chunk. At this point, the LOOP_CONDITION will be checked again. The loop terminates immediately when the condition is evaluated to be FALSE. Based on the template above, it is important to note that the code chunk executed must somehow cause the loop to exit. In particular, the code chunk needs to change the values of certain objects, which would eventually lead to the change of the LOOP_CONDITION. If nothing ever changes the LOOP_CONDITION, R will crash due to the infinite loops. Let’s come back to our password checker. This time let’s create a dumb checker. When you give a wrong password which is smaller than the true passcode, it will automatically approach the right answer for you (and of course no real-world application would do that!) ans &lt;- 90 guess &lt;- 83 while(guess != ans){ cat(&quot;Your `guess` is too small! \\nThe system will take care for you!\\n&quot;) guess &lt;- guess + 1 cat(&quot;Now the system is adjusting your `guess` to &quot;, guess, &quot;\\n\\n&quot;) } Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 84 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 85 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 86 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 87 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 88 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 89 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 90 cat(&#39;Great! The passcode is finally cracked.\\n&#39;) Great! The passcode is finally cracked. Exercise 5.3 In the above example, if the guess is smaller than ans, our script works fine. However, if the guess is larger than ans, then our script will crash. How to fix it? In other words, a revised script should produce the following results when guess=83 &lt; ans=90: Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 84 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 85 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 86 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 87 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 88 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 89 Your `guess` is too small! The system will take care for you! Now the system is adjusting your `guess` to 90 And your script should produce the following results when guess=100 &gt; ans=90: Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 99 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 98 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 97 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 96 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 95 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 94 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 93 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 92 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 91 Your `guess` is too large! The system will take care for you! Now the system is adjusting your `guess` to 90 5.5 Toy Example Now we are playing the Guess Game. The game is as follows: The program will pick a random number from 1 to 100. A user has to guess which number the computer has picked. Every time the user makes a wrong guess, the computer will tell the user whether the correct answer is higher or lower. We first pack the game as an R function object: guessMyNumber &lt;- function(){ ## Randomly select an integer from 1 to 100 ans &lt;- sample(1:100, size = 1) ## Instructions for user print(&quot;Now I am thinking of a number between 1 and 100.&quot;) ## Read the prompt input from user guess &lt;- readline(prompt = &quot;Please guess my number(0~100):&quot;) ## Convert input string into integer guess &lt;- as.numeric(guess) ## As long as user&#39;s guess is not the answer while(guess != ans){ ## if user&#39;s guess is smaller than the answer if(guess &lt; ans){ writeLines(&quot;The asnwer is HIGHER.&quot;) guess &lt;- readline(prompt = &quot;Please guess my number(0~100):&quot;) guess &lt;- as.numeric(guess) ## if user&#39;s guess is larger than the answer }else{ writeLines(&quot;The asnwer is LOWER&quot;) guess &lt;- readline(prompt = &quot;Please guess my number(0~100):&quot;) guess &lt;- as.numeric(guess) } } ## Exit the While-loop writeLines(paste0(&quot;Good Job! You had the correct answer! My number is &quot;, guess)) } # endfunc After you load the above code chunk and create the guessMyNumber() function in your current R environment, you can play the game by running the function guessMyNumber(): guessMyNumber() Exercise 5.4 The above guessMyNumber() can be improved. Sometimes naughty (careless) users would not input numbers as requested. Instead, they may accidentally (or on purpose) enter characters that are NOT digits at all in their guesses. How can you adjust the guessMyNumber() so that when users enter non-digit characters, your program will send out a warning message automatically? An example output from the revised version is provided below. &gt; guessMyNumber_v2() Please guess my number(0~100):12 The asnwer is HIGHER. Please guess my number(0~100):80 The asnwer is LOWER Please guess my number(0~100):1000 The asnwer is LOWER Please guess my number(0~100):a &lt;WARNING&gt;Please behave. Enter an INTEGER!!!&lt;WARNING&gt; Please guess my number(0~100):df &lt;WARNING&gt;Please behave. Enter an INTEGER!!!&lt;WARNING&gt; Please guess my number(0~100):`13` &lt;WARNING&gt;Please behave. Enter an INTEGER!!!&lt;WARNING&gt; Please guess my number(0~100):frw &lt;WARNING&gt;Please behave. Enter an INTEGER!!!&lt;WARNING&gt; Please guess my number(0~100):50 The asnwer is LOWER Please guess my number(0~100):30 The asnwer is HIGHER. Please guess my number(0~100):40 The asnwer is HIGHER. Please guess my number(0~100):45 The asnwer is LOWER Please guess my number(0~100):43 The asnwer is LOWER Please guess my number(0~100):42 The asnwer is LOWER Please guess my number(0~100):41 Correct! "]]
